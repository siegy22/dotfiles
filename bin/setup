#!/usr/bin/env bash

set -euo pipefail

mkdir -p ~/.ssh
mkdir -p ~/.bin

if [[ "$OSTYPE" == "darwin"* ]]; then
    /bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"
fi

if [ -x "$(command -v brew)" ]; then
    brew bundle
elif [ -x "$(command -v apt)" ]; then
    sudo apt install zsh
elif [ -x "$(command -v dnf)" ]; then
    sudo dnf install zsh
else
    echo "Cannot automatically install zsh, aborting..."
    exit 1
fi

sh -c "$(curl -fsSL https://raw.github.com/ohmyzsh/ohmyzsh/master/tools/install.sh)" || true

cd ~
rm -f .zshrc
rm -f .zshenv
ln -s dotfiles/zshrc .zshrc
ln -s dotfiles/zshenv .zshenv

cd ~/.oh-my-zsh/themes
rm -f cloud-light.zsh-theme
rm -f cloud-light-non-local.zsh-theme
ln -s ../../dotfiles/zsh/cloud-light.zsh-theme . 
ln -s ../../dotfiles/zsh/cloud-light-non-local.zsh-theme .

cd ~/.ssh
rm -f ./config
ln -s ../dotfiles/ssh/config ./config

source ~/.zshrc
